/** @license
* crossroads <http://millermedeiros.github.com/crossroads.js/>
* Author: Miller Medeiros | MIT License
* v0.12.0 (2013/01/21 13:47)
*/
(function(){var n=function(n){function i(n,t){if(n.indexOf)return n.indexOf(t);for(var i=n.length;i--;)if(n[i]===t)return i;return-1}function o(n,t){var r=i(n,t);r!==-1&&n.splice(r,1)}function s(n,t){return"[object "+t+"]"===Object.prototype.toString.call(n)}function h(n){return s(n,"RegExp")}function a(n){return s(n,"Array")}function c(n){return typeof n=="function"}function u(n){return n===null||n==="null"?null:n==="true"?!0:n==="false"?!1:n===e||n==="undefined"?e:n===""||isNaN(n)?n:parseFloat(n)}function v(n){for(var t=n.length,i=[];t--;)i[t]=u(n[t]);return i}function y(n,t){for(var f=(n||"").replace("?","").split("&"),e=f.length,o={},i,r;e--;)i=f[e].split("="),r=t?u(i[1]):i[1],o[i[0]]=typeof r=="string"?decodeURIComponent(r):r;return o}function r(){this.bypassed=new n.Signal;this.routed=new n.Signal;this._routes=[];this._prevRoutes=[];this._piped=[];this.resetState()}function l(t,i,r,u){var f=h(t),e=u.patternLexer;this._router=u;this._pattern=t;this._paramsIds=f?null:e.getParamIds(t);this._optionalParamsIds=f?null:e.getOptionalParamsIds(t);this._matchRegexp=f?t:e.compilePattern(t,u.ignoreCase);this.matched=new n.Signal;this.switched=new n.Signal;i&&this.matched.add(i);this._priority=r||0}var t,f,e;return f=/t(.+)?/.exec("t")[1]==="",r.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0;this._prevMatchedRequest=null;this._prevBypassedRequest=null},create:function(){return new r},addRoute:function(n,t,i){var r=new l(n,t,i,this);return this._sortedInsert(r),r},removeRoute:function(n){o(this._routes,n);n._destroy()},removeAllRoutes:function(){for(var n=this.getNumRoutes();n--;)this._routes[n]._destroy();this._routes.length=0},parse:function(n,t){if(n=n||"",t=t||[],this.ignoreState||n!==this._prevMatchedRequest&&n!==this._prevBypassedRequest){var r=this._getMatchedRoutes(n),u=0,f=r.length,i;if(f)for(this._prevMatchedRequest=n,this._notifyPrevRoutes(r,n),this._prevRoutes=r;u<f;)i=r[u],i.route.matched.dispatch.apply(i.route.matched,t.concat(i.params)),i.isFirst=!u,this.routed.dispatch.apply(this.routed,t.concat([n,i])),u+=1;else this._prevBypassedRequest=n,this.bypassed.dispatch.apply(this.bypassed,t.concat([n]));this._pipeParse(n,t)}},_notifyPrevRoutes:function(n,t){for(var r=0,i;i=this._prevRoutes[r++];)i.route.switched&&this._didSwitch(i.route,n)&&i.route.switched.dispatch(t)},_didSwitch:function(n,t){for(var i,r=0;i=t[r++];)if(i.route===n)return!1;return!0},_pipeParse:function(n,t){for(var r=0,i;i=this._piped[r++];)i.parse(n,t)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(n){var t=this._routes,i=t.length;do--i;while(t[i]&&n._priority<=t[i]._priority);t.splice(i+1,0,n)},_getMatchedRoutes:function(n){for(var i=[],r=this._routes,u=r.length,t;t=r[--u];)if((!i.length||this.greedy||t.greedy)&&t.match(n)&&i.push({route:t,params:t._getParamsArray(n)}),!this.greedyEnabled&&i.length)break;return i},pipe:function(n){this._piped.push(n)},unpipe:function(n){o(this._piped,n)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},t=new r,t.VERSION="0.12.0",t.NORM_AS_ARRAY=function(n,t){return[t.vals_]},t.NORM_AS_OBJECT=function(n,t){return[t]},l.prototype={greedy:!1,rules:void 0,match:function(n){return n=n||"",this._matchRegexp.test(n)&&this._validateParams(n)},_validateParams:function(n){var i=this.rules,r=this._getParamsObject(n);for(var t in i)if(t!=="normalize_"&&i.hasOwnProperty(t)&&!this._isValidParam(n,t,r))return!1;return!0},_isValidParam:function(n,t,r){var u=this.rules[t],f=r[t],e=!1,o=t.indexOf("?")===0;return f==null&&this._optionalParamsIds&&i(this._optionalParamsIds,t)!==-1?e=!0:h(u)?(o&&(f=r[t+"_"]),e=u.test(f)):a(u)?(o&&(f=r[t+"_"]),e=this._isValidArrayRule(u,f)):c(u)&&(e=u(f,n,r)),e},_isValidArrayRule:function(n,t){if(!this._router.ignoreCase)return i(n,t)!==-1;typeof t=="string"&&(t=t.toLowerCase());for(var u=n.length,r,f;u--;)if(r=n[u],f=typeof r=="string"?r.toLowerCase():r,f===t)return!0;return!1},_getParamsObject:function(n){for(var h=this._router.shouldTypecast,o=this._router.patternLexer.getParamValues(n,this._matchRegexp,h),r={},e=o.length,s,t;e--;)t=o[e],this._paramsIds&&(s=this._paramsIds[e],s.indexOf("?")===0&&t&&(r[s+"_"]=t,t=y(t,h),o[e]=t),f&&t===""&&i(this._optionalParamsIds,s)!==-1&&(t=void 0,o[e]=t),r[s]=t),r[e]=t;return r.request_=h?u(n):n,r.vals_=o,r},_getParamsArray:function(n){var t=this.rules?this.rules.normalize_:null;return t=t||this._router.normalizeFn,t&&c(t)?t(n,this._getParamsObject(n)):this._getParamsObject(n).vals_},interpolate:function(n){var t=this._router.patternLexer.interpolate(this._pattern,n);if(!this._validateParams(t))throw new Error("Generated string doesn't validate against `Route.rules`.");return t},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose();this.switched.dispose();this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},r.prototype.patternLexer=function(){function l(){var i,t;for(i in n)n.hasOwnProperty(i)&&(t=n[i],t.id="__CR_"+i+"__",t.save="save"in t?t.save.replace("{{id}}",t.id):t.id,t.rRestore=new RegExp(t.id,"g"))}function e(n,t){var i=[],r;for(n.lastIndex=0;r=n.exec(t);)i.push(r[1]);return i}function a(n){return e(r,n)}function y(t){return e(n.OP.rgx,t)}function p(n,r){return n=n||"",n&&(t===i?n=n.replace(h,""):t===f&&(n=n.replace(c,"")),n=o(n,"rgx","save"),n=n.replace(s,"\\$&"),n=o(n,"rRestore","res"),t===i&&(n="\\/?"+n)),t!==u&&(n+="\\/?"),new RegExp("^"+n+"$",r?"i":"")}function o(t,i,r){var u;for(var f in n)n.hasOwnProperty(f)&&(u=n[f],t=t.replace(u[i],u[r]));return t}function w(n,t,i){var r=t.exec(n);return r&&(r.shift(),i&&(r=v(r))),r}function b(t,i){if(typeof t!="string")throw new Error("Route pattern should be a string.");var u=function(n,t){var r,u,f;if(t=t.substr(0,1)==="?"?t.substr(1):t,i[t]!=null){if(typeof i[t]=="object"){u=[];for(f in i[t])u.push(encodeURI(f+"="+i[t][f]));r="?"+u.join("&")}else r=String(i[t]);if(n.indexOf("*")===-1&&r.indexOf("/")!==-1)throw new Error('Invalid value "'+r+'" for segment "'+n+'".');}else if(n.indexOf("{")!==-1)throw new Error("The segment "+n+" is required.");else r="";return r};return n.OS.trail||(n.OS.trail=new RegExp("(?:"+n.OS.id+")+$")),t.replace(n.OS.rgx,n.OS.save).replace(r,u).replace(n.OS.trail,"").replace(n.OS.rRestore,"/")}var s=/[\\.+*?\^$\[\](){}\/'#]/g,h=/^\/|\/$/g,c=/\/$/g,r=/(?:\{|:)([^}:]+)(?:\}|:)/g,n={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},i=1,u=2,f=3,t=i;return l(),{strict:function(){t=u},loose:function(){t=i},legacy:function(){t=f},getParamIds:a,getOptionalParamsIds:y,getParamValues:w,compilePattern:p,interpolate:b}}(),t};typeof define=="function"&&define.amd?define(["signals"],n):typeof module!="undefined"&&module.exports?module.exports=n(require("signals")):window.crossroads=n(window.signals)})();